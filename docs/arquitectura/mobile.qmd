# Aplicaci√≥n M√≥vil

UpTrack Mobile es una aplicaci√≥n nativa construida con React Native y Expo, dise√±ada para consulta r√°pida del estado de los sistemas monitoreados desde dispositivos Android e iOS.

## Caracter√≠sticas Principales

| Caracter√≠stica | Descripci√≥n |
|---------------|-------------|
| **Dashboard** | Vista general con estad√≠sticas y alertas activas |
| **Lista de Sistemas** | Todos los targets con filtros por estado |
| **Detalle de Target** | M√©tricas, historial y configuraci√≥n |
| **Widget Android** | Widget nativo para pantalla de inicio |
| **Notificaciones Push** | Alertas en tiempo real (futuro) |
| **Modo Offline** | Cach√© local con AsyncStorage |

## Stack Tecnol√≥gico

| Categor√≠a | Tecnolog√≠a | Versi√≥n |
|-----------|-----------|---------|
| Framework | React Native | 0.81 |
| Plataforma | Expo | 54 |
| Lenguaje | TypeScript | 5.9 |
| UI | React Native SVG | 15.12 |
| Storage | AsyncStorage | 2.2 |
| Widgets | react-native-android-widget | 0.20 |
| Runtime | React | 19.1 |

## Estructura del Proyecto

```
up-track-mobile/
‚îú‚îÄ‚îÄ App.tsx                 # Punto de entrada
‚îú‚îÄ‚îÄ app.json               # Configuraci√≥n Expo
‚îú‚îÄ‚îÄ eas.json               # Configuraci√≥n EAS Build
‚îú‚îÄ‚îÄ index.ts               # Registro de la app
‚îú‚îÄ‚îÄ package.json           # Dependencias
‚îú‚îÄ‚îÄ tsconfig.json          # Configuraci√≥n TypeScript
‚îú‚îÄ‚îÄ assets/                # Iconos y splash screens
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ api/
    ‚îÇ   ‚îú‚îÄ‚îÄ config.ts      # URL base del API
    ‚îÇ   ‚îî‚îÄ‚îÄ fetch.ts       # Cliente HTTP con auth
    ‚îú‚îÄ‚îÄ components/
    ‚îÇ   ‚îú‚îÄ‚îÄ BottomTabBar.tsx
    ‚îÇ   ‚îî‚îÄ‚îÄ Layout.tsx
    ‚îú‚îÄ‚îÄ context/
    ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx # Gesti√≥n de sesi√≥n
    ‚îú‚îÄ‚îÄ navigation/
    ‚îÇ   ‚îî‚îÄ‚îÄ AppNavigator.tsx # Navegaci√≥n entre pantallas
    ‚îú‚îÄ‚îÄ screens/
    ‚îÇ   ‚îú‚îÄ‚îÄ LoginScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ DashboardScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ SystemsScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ TargetDetailsScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ AddTargetScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ SettingsScreen.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ NotificationsScreen.tsx
    ‚îÇ   ‚îî‚îÄ‚îÄ WidgetConfigScreen.tsx
    ‚îú‚îÄ‚îÄ theme/
    ‚îÇ   ‚îî‚îÄ‚îÄ colors.ts      # Paleta de colores
    ‚îî‚îÄ‚îÄ widgets/
        ‚îú‚îÄ‚îÄ SystemStatusWidget.tsx
        ‚îî‚îÄ‚îÄ widget-task-handler.tsx
```

## Sistema de Navegaci√≥n

La aplicaci√≥n utiliza un sistema de navegaci√≥n basado en estado (sin React Navigation para mantener el bundle ligero):

```tsx
// AppNavigator.tsx
type Screen = TabScreen | 'addTarget' | 'targetDetails' | 'notifications' | 'widgetConfig';

const AppNavigator: React.FC = () => {
  const { isLoggedIn, loading } = useAuth();
  const [currentScreen, setCurrentScreen] = useState<Screen>('dashboard');
  const [selectedTargetId, setSelectedTargetId] = useState<string | null>(null);

  // Navegaci√≥n condicional basada en autenticaci√≥n
  if (!isLoggedIn) {
    return <LoginScreen />;
  }

  // Renderizado de pantalla actual
  switch (currentScreen) {
    case 'dashboard':
      return <DashboardScreen onNavigateToDetails={navigateToDetails} />;
    case 'systems':
      return <SystemsScreen onNavigateToDetails={navigateToDetails} />;
    // ...
  }
};
```

### Pantallas Disponibles

| Pantalla | Tab | Descripci√≥n |
|----------|-----|-------------|
| `LoginScreen` | - | Autenticaci√≥n de usuario |
| `DashboardScreen` | üè† | Estad√≠sticas y alertas activas |
| `SystemsScreen` | üìä | Lista completa de targets |
| `TargetDetailsScreen` | - | Detalle con m√©tricas de un target |
| `AddTargetScreen` | - | Formulario para crear target |
| `SettingsScreen` | ‚öôÔ∏è | Configuraci√≥n de la app |
| `NotificationsScreen` | - | Preferencias de notificaciones |
| `WidgetConfigScreen` | - | Configuraci√≥n del widget |

## Cliente API

El cliente HTTP centraliza la autenticaci√≥n usando AsyncStorage:

```typescript
// api/fetch.ts
export async function fetchWithAuth(url: string, options: RequestInit = {}) {
  const token = await AsyncStorage.getItem('token');
  
  // Cache busting para peticiones GET
  const method = options.method?.toUpperCase() || 'GET';
  let finalUrl = url;
  
  if (method === 'GET') {
    const separator = url.includes('?') ? '&' : '?';
    finalUrl = `${url}${separator}_t=${Date.now()}`;
  }

  const response = await fetch(`${API_BASE_URL}${finalUrl}`, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${token}`,
    },
  });

  // Logout autom√°tico si el token expir√≥
  if (response.status === 401) {
    await AsyncStorage.removeItem('token');
    throw new Error('Unauthorized');
  }

  return response;
}
```

## Contexto de Autenticaci√≥n

Gesti√≥n de sesi√≥n mediante React Context y AsyncStorage:

```tsx
// context/AuthContext.tsx
interface AuthContextType {
  isLoggedIn: boolean;
  token: string | null;
  loading: boolean;
  login: (token: string) => Promise<void>;
  logout: () => Promise<void>;
}

export const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [token, setToken] = useState<string | null>(null);

  // Verificar token almacenado al iniciar
  useEffect(() => {
    const checkAuth = async () => {
      const storedToken = await AsyncStorage.getItem('token');
      if (storedToken) {
        setToken(storedToken);
        setIsLoggedIn(true);
      }
    };
    checkAuth();
  }, []);

  const login = async (newToken: string) => {
    await AsyncStorage.setItem('token', newToken);
    setToken(newToken);
    setIsLoggedIn(true);
  };

  const logout = async () => {
    await AsyncStorage.removeItem('token');
    setToken(null);
    setIsLoggedIn(false);
  };
};
```

## Widget Android

La aplicaci√≥n incluye un widget nativo para Android que muestra el estado de un sistema seleccionado:

```tsx
// widgets/SystemStatusWidget.tsx
interface SystemStatusWidgetProps {
  systemName: string;
  status: 'UP' | 'DOWN' | 'PENDING' | 'UNKNOWN';
  lastChecked: string;
  responseTime: number | null;
}

export function SystemStatusWidget({
  systemName,
  status,
  lastChecked,
  responseTime,
}: SystemStatusWidgetProps) {
  return (
    <FlexWidget
      style={{
        backgroundColor: '#1E293B',
        borderRadius: 16,
        padding: 16,
      }}
      clickAction="OPEN_APP"
    >
      <TextWidget text={systemName} />
      <TextWidget 
        text={getStatusText(status)} 
        style={{ color: getStatusColor(status) }}
      />
      <TextWidget text={`√öltimo check: ${lastChecked}`} />
      {responseTime && (
        <TextWidget text={`${responseTime}ms`} />
      )}
    </FlexWidget>
  );
}
```

### Caracter√≠sticas del Widget

- **Tama√±o**: 2x1 celdas m√≠nimo
- **Actualizaci√≥n**: Peri√≥dica o por evento
- **Acci√≥n**: Abre la app al tocar
- **Tema**: Oscuro para mejor visibilidad

## Tema y Colores

Paleta de colores consistente con la versi√≥n web:

```typescript
// theme/colors.ts
export const colors = {
  // Backgrounds
  background: '#0F172A',
  backgroundCard: '#1E293B',
  backgroundInput: '#334155',
  
  // Text
  textMain: '#F8FAFC',
  textMuted: '#94A3B8',
  
  // Status
  statusSuccess: '#22C55E',  // UP - Verde
  statusDanger: '#EF4444',   // DOWN - Rojo
  statusWarning: '#F59E0B',  // DEGRADED - Amarillo
  statusInfo: '#3B82F6',     // Primary - Azul
  
  // UI
  primary: '#3B82F6',
  border: '#334155',
};
```

## Configuraci√≥n de Expo

```json
// app.json
{
  "expo": {
    "name": "UpTrack",
    "slug": "up-track-mobile",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "splash": {
      "image": "./assets/splash-icon.png",
      "backgroundColor": "#0F172A"
    },
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.uptrack.mobile"
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#0F172A"
      },
      "package": "com.uptrack.mobile"
    }
  }
}
```

## Desarrollo Local

### Requisitos

- Node.js 18+
- pnpm (recomendado)
- Expo CLI
- Android Studio / Xcode (para emuladores)
- Expo Go app (para dispositivo f√≠sico)

### Instalaci√≥n y Ejecuci√≥n

```bash
# Instalar dependencias
cd up-track-mobile
pnpm install

# Iniciar servidor de desarrollo
pnpm start

# Ejecutar en Android
pnpm android

# Ejecutar en iOS
pnpm ios

# Ejecutar en navegador web
pnpm web
```

### Configuraci√≥n del API

Editar `src/api/config.ts`:

```typescript
// Para desarrollo local con dispositivo f√≠sico
export const API_BASE_URL = 'http://192.168.1.X:8080';

// Para emulador Android
export const API_BASE_URL = 'http://10.0.2.2:8080';

// Para producci√≥n
export const API_BASE_URL = 'https://api.uptrack.example.com';
```

## Build de Producci√≥n

### EAS Build (Recomendado)

```bash
# Instalar EAS CLI
npm install -g eas-cli

# Login en Expo
eas login

# Build para Android (APK)
eas build --platform android --profile preview

# Build para iOS
eas build --platform ios --profile preview

# Build de producci√≥n
eas build --platform all --profile production
```

### Configuraci√≥n EAS (eas.json)

```json
{
  "build": {
    "preview": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      }
    },
    "production": {
      "android": {
        "buildType": "app-bundle"
      }
    }
  }
}
```

## Funcionalidades Futuras

| Funcionalidad | Estado | Descripci√≥n |
|--------------|--------|-------------|
| Push Notifications | üîú Planificado | Alertas en tiempo real v√≠a Firebase/APNs |
| Widget iOS | üîú Planificado | Widget para pantalla de inicio iOS |
| Modo Offline | üîú Planificado | Cach√© completo con sincronizaci√≥n |
| Biometr√≠a | üîú Planificado | Autenticaci√≥n con huella/Face ID |
| Deep Links | üîú Planificado | Abrir target espec√≠fico desde notificaci√≥n |
