# Frontend y Experiencia de Usuario

UpTrackAI ofrece interfaces modernas para la gestión del monitoreo.

## Diagrama de Contenedores (C4 Nivel 2)

El sistema expone interfaces para usuarios finales y administradores.

![Diagrama de Contenedores](../diagrams/img/Diagrama de Contenedores C4 - UpTrackAI.png)

### Aplicaciones

1.  **SPA Web (React):** Panel de control principal. Permite gestión completa de targets, visualización de gráficas y configuración de cuenta.
2.  **App Móvil (Kotlin):** Aplicación nativa para consulta rápida de estados y recepción de notificaciones push (futuro).

## Integración con Telegram (Magic Link)

Para facilitar la vinculación de cuentas de Telegram sin fricción, se implementó un sistema de "Magic Link".

### Flujo de Vinculación

1.  **Solicitud:** El usuario hace clic en "Conectar Telegram" en la Web App.
2.  **Generación:** El backend genera un token único de corta duración (15 min).
3.  **Redirección:** Se abre un deep link a Telegram (`t.me/UpTrackBot?start=TOKEN`).
4.  **Vinculación:** Al dar "Start", el bot envía el token al backend, que asocia el Chat ID con el usuario.

Este mecanismo elimina la necesidad de que el usuario copie y pegue códigos manualmente.

## Stack Tecnológico

- **Lenguaje**: TypeScript
- **Framework**: React 18 con Vite
- **Estilos**: Tailwind CSS
- **Gestión de Estado**: Hooks de React + Context
- **Enrutamiento**: React Router
- **Cliente API**: Fetch API con hooks personalizados
- **Herramienta de Build**: Vite

## Estructura de Componentes

```
src/
├── components/
│   ├── layout/          # Componentes de layout (Header, Sidebar)
│   └── ui/             # Componentes UI reutilizables
├── pages/              # Componentes de página
│   ├── Dashboard.tsx
│   ├── Systems.tsx
│   ├── AddTarget.tsx
│   └── TargetDetail.tsx
├── api/                # Funciones cliente API
├── data/               # Tipos de datos y constantes
└── assets/             # Activos estáticos
```

Utiliza gestión de estado integrada de React:

- **Estado Local**: useState para estado de componentes
- **Estado del Servidor**: Hooks personalizados para datos API
- **Estado Global**: Context para sesión de usuario
- **Estado de Formularios**: Componentes controlados

## Integración con API

Hooks personalizados para obtención de datos:

```typescript
const useTargets = () => {
  const [targets, setTargets] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchTargets().then(setTargets).finally(() => setLoading(false));
  }, []);

  return { targets, loading };
};
```

## Diseño Responsivo

Enfoque mobile-first con Tailwind CSS:

- **Sistema de Breakpoints**: breakpoints sm/md/lg/xl
- **Layout Grid**: Flexbox y CSS Grid
- **Biblioteca de Componentes**: Componentes UI consistentes
- **Modo Oscuro**: Capacidad de cambio de tema

## Inicialización y Despliegue

Esta sección detalla cómo poner en marcha la aplicación frontend, ya sea para desarrollo local o para despliegue en producción utilizando contenedores.

### Desarrollo Local (Sin Docker)

Ideal para el desarrollo activo y pruebas rápidas.

**Requisitos:**
- Node.js (v18+)
- pnpm (recomendado)

**Pasos:**

1.  **Instalación de dependencias:**
    ```bash
    cd uptrack-gui
    pnpm install
    ```

2.  **Configuración de Entorno:**
    Cree un archivo `.env` en la raíz del proyecto `uptrack-gui` para definir la URL del backend API.
    ```properties
    VITE_API_URL=http://localhost:8080
    ```

3.  **Ejecución:**
    Inicie el servidor de desarrollo con recarga en caliente (HMR).
    ```bash
    pnpm dev
    ```
    Acceda a la aplicación en `http://localhost:5173`.

### Despliegue con Docker

Para entornos de producción, utilizamos una construcción multi-etapa que compila la aplicación React y la sirve utilizando Nginx.

**1. Dockerfile**
Asegúrese de tener el siguiente `Dockerfile` en la raíz de `uptrack-gui`:

```dockerfile
# Etapa 1: Construcción
FROM node:20-alpine AS builder
WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --frozen-lockfile
COPY . .
RUN pnpm build

# Etapa 2: Servidor Web
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
# Configuración necesaria para SPA (React Router)
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**2. Configuración Nginx (nginx.conf)**
Necesario para manejar el enrutamiento del lado del cliente (evitar errores 404 al recargar).

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

**3. Comandos de Ejecución**

```bash
# Construir la imagen
docker build -t uptrack-gui .

# Ejecutar el contenedor (mapeando puerto 80 del contenedor al 3000 del host)
docker run -d -p 3000:80 --name uptrack-frontend uptrack-gui
```

La aplicación estará disponible en `http://localhost:3000`.