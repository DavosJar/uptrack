# Frontend y Experiencia de Usuario

UpTrackAI ofrece una interfaz web moderna construida con React 19 y TypeScript, diseÃ±ada para proporcionar visibilidad en tiempo real del estado de los sistemas monitoreados.

## Diagrama de Contenedores (C4 Nivel 2)

El sistema expone interfaces para usuarios finales y administradores.

![Diagrama de Contenedores](../diagrams/img/Diagrama de Contenedores C4 - UpTrackAI.png)

## Arquitectura de la AplicaciÃ³n

## Estructura del Proyecto

```
uptrack-gui/
â”œâ”€â”€ index.html              # Punto de entrada HTML
â”œâ”€â”€ vite.config.ts          # ConfiguraciÃ³n de Vite
â”œâ”€â”€ tailwind.config.js      # ConfiguraciÃ³n de Tailwind CSS
â”œâ”€â”€ tsconfig.json           # ConfiguraciÃ³n TypeScript
â”œâ”€â”€ package.json            # Dependencias y scripts
â””â”€â”€ src/
    â”œâ”€â”€ main.tsx           # Bootstrap de React
    â”œâ”€â”€ App.tsx            # Router y rutas protegidas
    â”œâ”€â”€ index.css          # Estilos globales y tema
    â”œâ”€â”€ api/
    â”‚   â””â”€â”€ fetch.ts       # Cliente HTTP con auth
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ layout/
    â”‚   â”‚   â””â”€â”€ MainLayout.tsx  # Layout principal
    â”‚   â””â”€â”€ ui/
    â”‚       â”œâ”€â”€ Button.tsx      # BotÃ³n reutilizable
    â”‚       â”œâ”€â”€ FormField.tsx   # Campo de formulario
    â”‚       â”œâ”€â”€ Modal.tsx       # DiÃ¡logo modal
    â”‚       â”œâ”€â”€ PageHeader.tsx  # Cabecera de pÃ¡gina
    â”‚       â””â”€â”€ NotificationBell.tsx # Campana de alertas
    â”œâ”€â”€ context/
    â”‚   â””â”€â”€ ThemeContext.tsx    # Modo claro/oscuro
    â”œâ”€â”€ pages/
    â”‚   â”œâ”€â”€ Login.tsx          # AutenticaciÃ³n
    â”‚   â”œâ”€â”€ Dashboard.tsx      # Vista principal
    â”‚   â”œâ”€â”€ Systems.tsx        # Lista de targets
    â”‚   â”œâ”€â”€ TargetDetail.tsx   # Detalle con mÃ©tricas
    â”‚   â”œâ”€â”€ AddTarget.tsx      # Crear nuevo target
    â”‚   â”œâ”€â”€ Profile.tsx        # Perfil de usuario
    â”‚   â”œâ”€â”€ Settings.tsx       # ConfiguraciÃ³n
    â”‚   â””â”€â”€ Reports.tsx        # Reportes
    â””â”€â”€ data/
        â””â”€â”€ types.ts           # Definiciones TypeScript
```

## Sistema de Rutas

La aplicaciÃ³n utiliza React Router v7 con rutas protegidas basadas en autenticaciÃ³n:

| Ruta | Componente | Protegida | DescripciÃ³n |
|------|-----------|-----------|-------------|
| `/login` | Login | No | Formulario de autenticaciÃ³n |
| `/dashboard` | Dashboard | SÃ­ | Vista general con estadÃ­sticas |
| `/systems` | Systems | SÃ­ | Lista completa de targets |
| `/target/:id` | TargetDetail | SÃ­ | MÃ©tricas detalladas de un target |
| `/add-target` | AddTarget | SÃ­ | Formulario para crear target |
| `/profile` | Profile | SÃ­ | ConfiguraciÃ³n de perfil y Telegram |
| `/settings` | Settings | SÃ­ | Preferencias de la aplicaciÃ³n |
| `/reports` | Reports | SÃ­ | Reportes y exportaciÃ³n |

**ProtecciÃ³n de Rutas:**

```tsx
// App.tsx - VerificaciÃ³n de autenticaciÃ³n
const [isLoggedIn, setIsLoggedIn] = useState(!!localStorage.getItem('token'));

<Route path="/dashboard" element={
  isLoggedIn ? (
    <MainLayout>
      <Dashboard />
    </MainLayout>
  ) : (
    <Navigate to="/login" />
  )
} />
```

## Cliente API

El cliente HTTP centraliza la autenticaciÃ³n y manejo de sesiÃ³n expirada:

```typescript
// api/fetch.ts
export async function fetchWithAuth(url: string, options: RequestInit = {}) {
  const token = localStorage.getItem('token');
  
  const response = await fetch(`${import.meta.env.VITE_API_BASE_URL}${url}`, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${token}`,
    },
  });

  // RedirecciÃ³n automÃ¡tica si el token expirÃ³
  if (response.status === 401) {
    localStorage.removeItem('token');
    window.location.href = '/login';
    throw new Error('Unauthorized');
  }

  return response;
}
```

## PÃ¡ginas Principales

### Dashboard

Vista principal que muestra:

- **EstadÃ­sticas globales**: Total de sistemas, online, con alertas
- **Lista de alertas**: Solo targets con problemas (DOWN, DEGRADED, FLAPPING, UNSTABLE)
- **Filtros**: BÃºsqueda por nombre/URL, filtro por estado

```tsx
// Estructura de datos de un Target
interface Target {
  id: string;
  name: string;
  url: string;
  target_type: string;        // "API" | "WEB"
  current_status: string;     // "UP" | "DOWN" | ...
  last_checked_at: string;
  avg_response_time: number;  // ms
}
```

### TargetDetail

Vista detallada de un target con:

- **InformaciÃ³n bÃ¡sica**: Nombre, URL, tipo, estado actual
- **GrÃ¡fico de latencia**: HistÃ³rico de tiempos de respuesta (Recharts)
- **Heatmap de disponibilidad**: VisualizaciÃ³n por hora/dÃ­a
- **Historial de checks**: Ãšltimos resultados individuales
- **ConfiguraciÃ³n**: Intervalo, timeout, umbral de latencia

### Profile

GestiÃ³n de perfil de usuario:

- EdiciÃ³n de nombre, idioma, zona horaria
- **VinculaciÃ³n con Telegram**: BotÃ³n que genera Magic Link
- VisualizaciÃ³n de canales de notificaciÃ³n activos

## Componentes UI

### Sistema de DiseÃ±o

La aplicaciÃ³n utiliza un sistema de tokens CSS para tematizaciÃ³n:

```css
/* index.css - Variables de tema */
:root {
  --background: #0a0a0a;
  --background-card: #111111;
  --background-input: #1a1a1a;
  --text-main: #ffffff;
  --text-muted: #a1a1aa;
  --primary: #3b82f6;
  --border-dark: #27272a;
  /* ... */
}
```

### Componentes Reutilizables

| Componente | Props | DescripciÃ³n |
|-----------|-------|-------------|
| `Button` | variant, size, loading, disabled | BotÃ³n con estados |
| `FormField` | label, error, type | Input con label y validaciÃ³n |
| `Modal` | isOpen, onClose, title | DiÃ¡logo modal |
| `PageHeader` | title, description, actions | Cabecera de pÃ¡gina |
| `NotificationBell` | count | Indicador de alertas |

### VisualizaciÃ³n de Estado

CÃ³digos de color consistentes para estados:

```tsx
const getStatusColor = (status: string) => {
  switch (status) {
    case 'UP':       return 'text-green-400';   // âœ… Verde
    case 'DOWN':     return 'text-red-400';     // ğŸ”´ Rojo
    case 'DEGRADED': return 'text-yellow-400';  // âš ï¸ Amarillo
    case 'FLAPPING': return 'text-orange-400';  // ğŸŸ  Naranja
    case 'UNSTABLE': return 'text-purple-400';  // ğŸŸ£ PÃºrpura
    default:         return 'text-gray-400';    // â“ Gris
  }
};
```

## GrÃ¡ficos con Recharts

La aplicaciÃ³n utiliza Recharts para visualizaciones:

```tsx
// GrÃ¡fico de latencia en TargetDetail
<ResponsiveContainer width="100%" height={300}>
  <AreaChart data={metricsData}>
    <CartesianGrid strokeDasharray="3 3" />
    <XAxis dataKey="timestamp" />
    <YAxis unit="ms" />
    <Tooltip />
    <Area 
      type="monotone" 
      dataKey="response_time" 
      stroke="#3b82f6" 
      fill="#3b82f680" 
    />
  </AreaChart>
</ResponsiveContainer>
```

## IntegraciÃ³n con Telegram

El flujo de vinculaciÃ³n desde el frontend:

1. Usuario navega a `/profile`
2. Click en "Conectar Telegram"
3. Frontend llama `POST /api/v1/telegram/link`
4. Backend retorna `{ deepLink: "t.me/bot?start=TOKEN" }`
5. Frontend abre el deep link (redirect a Telegram)
6. Usuario interactÃºa con el bot, vinculaciÃ³n completada

## Stack TecnolÃ³gico

| CategorÃ­a | TecnologÃ­a | VersiÃ³n |
|-----------|-----------|---------|
| Framework | React | 19.2 |
| Lenguaje | TypeScript | 5.9 |
| Build Tool | Vite | 7.2 |
| Estilos | Tailwind CSS | 4.1 |
| Routing | React Router | 7.10 |
| GrÃ¡ficos | Recharts | 3.5 |
| Iconos | Lucide React | 0.555 |
| Linting | ESLint | 9.39 |

## Desarrollo Local

### Requisitos

- Node.js 18+
- pnpm (recomendado) o npm

### InstalaciÃ³n y EjecuciÃ³n

```bash
# Instalar dependencias
cd uptrack-gui
pnpm install

# Configurar variable de entorno
echo "VITE_API_BASE_URL=http://localhost:8080" > .env

# Ejecutar en desarrollo (HMR)
pnpm dev

# Compilar para producciÃ³n
pnpm build

# Preview de producciÃ³n
pnpm preview
```

### Scripts Disponibles

| Comando | DescripciÃ³n |
|---------|-------------|
| `pnpm dev` | Servidor de desarrollo con HMR (puerto 5173) |
| `pnpm build` | CompilaciÃ³n de producciÃ³n |
| `pnpm preview` | Preview del build de producciÃ³n |
| `pnpm lint` | Ejecutar ESLint |

## Despliegue con Docker

### Dockerfile Multi-etapa

```dockerfile
# Etapa 1: ConstrucciÃ³n
FROM node:20-alpine AS builder
WORKDIR /app
COPY package.json pnpm-lock.yaml ./
RUN npm install -g pnpm && pnpm install --frozen-lockfile
COPY . .
ARG VITE_API_BASE_URL
ENV VITE_API_BASE_URL=$VITE_API_BASE_URL
RUN pnpm build

# Etapa 2: Servidor Web
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### ConfiguraciÃ³n Nginx para SPA

```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Soporte para React Router (client-side routing)
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache de assets estÃ¡ticos
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### Comandos Docker

```bash
# Construir imagen
docker build \
  --build-arg VITE_API_BASE_URL=https://api.uptrack.example.com \
  -t uptrack-gui .

# Ejecutar contenedor
docker run -d -p 3000:80 --name uptrack-frontend uptrack-gui
```

## Accesibilidad

La aplicaciÃ³n implementa buenas prÃ¡cticas de accesibilidad:

- **Roles ARIA**: `role="status"`, `role="alert"`, `aria-live`
- **Labels**: `aria-label` en elementos interactivos
- **NavegaciÃ³n por teclado**: `tabIndex` en elementos focalizables
- **Contraste**: Colores con ratio WCAG AA

```tsx
// Ejemplo de accesibilidad en Dashboard
<article 
  className="bg-background-card rounded-lg p-6"
  aria-label={`${totalTargets} sistemas en total`}
>
  <p className="text-3xl font-bold">{totalTargets}</p>
</article>
```