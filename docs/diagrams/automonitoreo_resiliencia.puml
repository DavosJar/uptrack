@startuml automonitoreo_resiliencia
!theme plain
title Arquitectura de Auto-Resiliencia y Telemetría Interna (Self-Monitoring)

package "UpTrackAI Backend Process" {
    
    component "Main Loop" as Main
    
    package "Watchdog System (Supervisor)" {
        [Health Check Endpoint\n/healthz] as Healthz
        [Panic Recovery Middleware] as Recover
        [Self-Diagnostics Service] as Diag
    }
    
    control "Runtime Stats" as Runtime #LightBlue
    database "Internal Connection Pool" as DBPool
}

cloud "External Watchdog" {
    [UptimeRobot / K8s Probe] as External
}

== Flujo Normal ==
Main -> Diag: Reportar Estado
Diag -> Runtime: Leer Goroutines/RAM
Diag -> DBPool: Check Open Connections

External -> Healthz: GET /healthz
Healthz -> Diag: Collect Metrics
Healthz --> External: 200 OK + JSON\n{goroutines: 45, db: "OK", ram: "12MB"}

== Flujo de Auto-Recuperación (Resiliencia) ==
note right of Main: CRASH repentino (Bug en Worker)

Main -[#red]-> Recover: PANIC DETECTED!
activate Recover
Recover -> Log: Registrar Stack Trace
Recover -> Diag: Registrar "Last Panic Event"
Recover -> Main: Reiniciar Goroutine
deactivate Recover

note right of Main: El sistema NO muere, solo se reinicia el hilo afectado.
External -> Healthz: GET /healthz
Healthz --> External: 200 OK (Alertando "Recovered from Crash")

@enduml
